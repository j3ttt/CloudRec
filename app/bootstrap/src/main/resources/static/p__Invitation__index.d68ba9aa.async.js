"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6090],{14904:function(me,I,n){n.r(I),n.d(I,{default:function(){return V}});var O=n(15009),g=n.n(O),U=n(99289),y=n.n(U),G=n(5574),c=n.n(G),W=n(55375),$=n(33651),S=n(98665),m=n(14748),T=n(87547),P=n(94149),f=n(39380),D=n(26),h=n(5966),Z=n(45830),H=n(68872),Y=n(57381),w=n(22181),C=n(83622),v=n(62435),p={invitation:"invitation___Fiy6u",invitationContainer:"invitationContainer___s31wH",invitationCard:"invitationCard___F9CsT",title:"title___KvZTK",subtitle:"subtitle___Io6iJ",loadingContainer:"loadingContainer___vfF73",loadingText:"loadingText___apBxr",errorContainer:"errorContainer___OKw9B",errorIcon:"errorIcon___K2Bdj",errorTitle:"errorTitle___YgWtk",errorMessage:"errorMessage___El_tT",autoJoinContainer:"autoJoinContainer___uNHfT",successIcon:"successIcon___VIG7W",autoJoinTitle:"autoJoinTitle___c91xT",autoJoinMessage:"autoJoinMessage___wMdGe",registerForm:"registerForm___v0UKo","ant-form-item":"ant-form-item___NslJY","ant-input":"ant-input___ODsuq","ant-btn":"ant-btn___Tp4Ed","ant-btn-primary":"ant-btn-primary___pNx2n",formTitle:"formTitle___ZTO9w"},e=n(86074),Q=function(){var X=H.ZP.useMessage(),z=c()(X,2),l=z[0],q=z[1],t=(0,Z.useIntl)(),_=(0,Z.useSearchParams)(),ee=c()(_,1),x=ee[0],ie=(0,v.useState)(!0),J=c()(ie,2),te=J[0],N=J[1],ne=(0,v.useState)(!1),R=c()(ne,2),ae=R[0],k=R[1],se=(0,v.useState)(null),A=c()(se,2),M=A[0],re=A[1],oe=(0,v.useState)("checking"),F=c()(oe,2),L=F[0],u=F[1],de=function(){var r=localStorage.getItem("JSESSIONID");return!!r},le=function(){var d=y()(g()().mark(function r(){var a,o;return g()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=x.get("code"),a){i.next=5;break}return u("invalid"),N(!1),i.abrupt("return");case 5:return i.prev=5,i.next=8,(0,$.checkInviteCode)({inviteCode:a});case 8:if(o=i.sent,!(o.code===200&&o.content)){i.next=19;break}if(re(o.content),!de()){i.next=16;break}return i.next=14,ue(a);case 14:i.next=17;break;case 16:u("register");case 17:i.next=20;break;case 19:u("invalid");case 20:i.next=26;break;case 22:i.prev=22,i.t0=i.catch(5),console.error("Error validating invite code:",i.t0),u("invalid");case 26:return i.prev=26,N(!1),i.finish(26);case 29:case"end":return i.stop()}},r,null,[[5,22,26,29]])}));return function(){return d.apply(this,arguments)}}(),ue=function(){var d=y()(g()().mark(function r(a){var o;return g()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,(0,S.joinTenant)({inviteCode:a});case 3:o=i.sent,o.code===200?(u("auto-join"),l.success(t.formatMessage({id:"invitation.message.join.success"})),setTimeout(function(){window.location.href="/home"},1500)):(l.error(o.msg||t.formatMessage({id:"invitation.message.join.failed"})),u("invalid")),i.next=12;break;case 7:i.prev=7,i.t0=i.catch(0),console.error("Auto join tenant error:",i.t0),l.error(t.formatMessage({id:"invitation.message.join.failed"})),u("invalid");case 12:case"end":return i.stop()}},r,null,[[0,7]])}));return function(a){return d.apply(this,arguments)}}(),ge=function(){var d=y()(g()().mark(function r(a){var o,j,i,B,ce,E,b;return g()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(o=a.userId,j=a.username,i=a.password,B=a.confirmPassword,ce=a.email,E=x.get("code"),i===B){s.next=5;break}return l.error(t.formatMessage({id:"invitation.message.password.mismatch"})),s.abrupt("return");case 5:return k(!0),s.prev=6,s.next=9,(0,S.register)({userId:o,username:j,password:i,code:E});case 9:b=s.sent,b.code===200?(l.success(t.formatMessage({id:"invitation.message.register.success"})),setTimeout(function(){var K=x.get("code"),ve=K?"/login?code=".concat(K):"/login";window.location.href=ve},1500)):l.error(b.msg||t.formatMessage({id:"invitation.message.register.failed"})),s.next=17;break;case 13:s.prev=13,s.t0=s.catch(6),console.error("Registration error:",s.t0),l.error(t.formatMessage({id:"invitation.message.register.failed"}));case 17:return s.prev=17,k(!1),s.finish(17);case 20:case"end":return s.stop()}},r,null,[[6,13,17,20]])}));return function(a){return d.apply(this,arguments)}}();return(0,v.useEffect)(function(){le()},[]),te?(0,e.jsxs)(f._z,{ghost:!0,title:!1,breadcrumb:void 0,childrenContentStyle:{padding:0,height:"100%"},className:p.invitation,children:[(0,e.jsx)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e3,background:"rgba(255, 255, 255, 0.9)",borderRadius:"6px",padding:"4px"},children:(0,e.jsx)(m.Z,{})}),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,e.jsx)(Y.Z,{size:"large"})})]}):L==="invalid"?(0,e.jsxs)(f._z,{ghost:!0,title:!1,breadcrumb:void 0,childrenContentStyle:{padding:0,height:"100%"},className:p.invitation,children:[(0,e.jsx)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e3,background:"rgba(255, 255, 255, 0.9)",borderRadius:"6px",padding:"4px"},children:(0,e.jsx)(m.Z,{})}),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,e.jsx)(w.ZP,{status:"error",title:t.formatMessage({id:"invitation.message.invalid"}),subTitle:t.formatMessage({id:"invitation.message.invalid.subtitle"}),extra:[(0,e.jsx)(C.ZP,{type:"primary",onClick:function(){return window.location.href="/home"},children:t.formatMessage({id:"invitation.button.text.return.home"})},"home")]})})]}):L==="auto-join"?(0,e.jsxs)(f._z,{ghost:!0,title:!1,breadcrumb:void 0,childrenContentStyle:{padding:0,height:"100%"},className:p.invitation,children:[(0,e.jsx)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e3,background:"rgba(255, 255, 255, 0.9)",borderRadius:"6px",padding:"4px"},children:(0,e.jsx)(m.Z,{})}),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,e.jsx)(w.ZP,{status:"success",title:t.formatMessage({id:"invitation.message.join.success"}),subTitle:t.formatMessage({id:"invitation.message.join.success.subtitle"}),extra:[(0,e.jsx)(C.ZP,{type:"primary",onClick:function(){return window.location.href="/home"},children:t.formatMessage({id:"invitation.button.text.return.home"})},"home")]})})]}):(0,e.jsxs)(f._z,{ghost:!0,title:!1,breadcrumb:void 0,childrenContentStyle:{padding:0,height:"100%"},className:p.invitation,children:[q,(0,e.jsx)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e3,background:"rgba(255, 255, 255, 0.9)",borderRadius:"6px",padding:"4px"},children:(0,e.jsx)(m.Z,{})}),(0,e.jsxs)(D.B,{backgroundImageUrl:"https://gw.alipayobjects.com/zos/rmsportal/FfdJeJRQWjEeGTpqgBKj.png",logo:"/favicon-light.ico",title:W.j2,subTitle:"CloudRec's Protecting More",onFinish:ge,submitter:{render:function(){return(0,e.jsx)(C.ZP,{loading:ae,type:"primary",htmlType:"submit",style:{height:40,width:"100%",borderRadius:6,fontSize:16},children:t.formatMessage({id:"individual.button.text.register"})})}},children:[M&&(0,e.jsxs)("div",{style:{marginBottom:24,padding:16,background:"#f6f8fa",borderRadius:8,border:"1px solid #e1e8ed"},children:[(0,e.jsxs)("div",{style:{fontSize:16,fontWeight:600,color:"#1890ff",marginBottom:12,textAlign:"center"},children:["\u{1F389} ",t.formatMessage({id:"invitation.message.invitation.received"})]}),(0,e.jsx)("div",{style:{fontSize:14,color:"#666",textAlign:"center"},children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("span",{style:{margin:"0 4px"},children:[M.inviter," ",t.formatMessage({id:"invitation.message.invitation.received"})]}),(0,e.jsx)("span",{style:{fontWeight:500},children:M.tenantName})]})})]}),(0,e.jsx)(h.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(T.Z,{className:"prefixIcon"})},placeholder:t.formatMessage({id:"invitation.input.text.username"}),rules:[{required:!0,message:t.formatMessage({id:"invitation.input.text.username"})}]}),(0,e.jsx)(h.Z,{name:"userId",fieldProps:{size:"large",prefix:(0,e.jsx)(T.Z,{className:"prefixIcon"})},placeholder:t.formatMessage({id:"invitation.input.text.user.id"}),rules:[{required:!0,message:t.formatMessage({id:"invitation.input.text.user.id"})}]}),(0,e.jsx)(h.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)(P.Z,{className:"prefixIcon"})},placeholder:t.formatMessage({id:"invitation.input.text.password"}),rules:[{required:!0,message:t.formatMessage({id:"invitation.input.text.password"})},{min:6,message:t.formatMessage({id:"invitation.input.text.password.length"})}]}),(0,e.jsx)(h.Z.Password,{name:"confirmPassword",fieldProps:{size:"large",prefix:(0,e.jsx)(P.Z,{className:"prefixIcon"})},placeholder:t.formatMessage({id:"invitation.input.text.password.confirm"}),rules:[{required:!0,message:t.formatMessage({id:"invitation.input.text.password.confirm"})}]}),(0,e.jsxs)("div",{style:{textAlign:"center",marginBottom:16,fontSize:14,color:"#666"},children:[t.formatMessage({id:"invitation.message.already.have.account"}),(0,e.jsx)("a",{style:{color:"#1890ff",marginLeft:4,textDecoration:"none"},onClick:function(){var r=x.get("code"),a=r?"/login?code=".concat(r):"/login";window.location.href=a},children:t.formatMessage({id:"invitation.message.already.have.account.login"})})]})]})]})},V=Q}}]);
