"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1374],{64317:function(ne,w,e){var M=e(1413),E=e(91),K=e(22270),C=e(62435),N=e(66758),p=e(58055),H=e(86074),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],S=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],z=function(g,W){var x=g.fieldProps,u=g.children,m=g.params,y=g.proFieldProps,L=g.mode,R=g.valueEnum,T=g.request,Y=g.showSearch,q=g.options,ee=(0,E.Z)(g,d),ue=(0,C.useContext)(N.Z);return(0,H.jsx)(p.Z,(0,M.Z)((0,M.Z)({valueEnum:(0,K.h)(R),request:T,params:m,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,M.Z)({options:q,mode:L,showSearch:Y,getPopupContainer:ue.getPopupContainer},x),ref:W,proFieldProps:y},ee),{},{children:u}))},b=C.forwardRef(function(t,g){var W=t.fieldProps,x=t.children,u=t.params,m=t.proFieldProps,y=t.mode,L=t.valueEnum,R=t.request,T=t.options,Y=(0,E.Z)(t,S),q=(0,M.Z)({options:T,mode:y||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},W),ee=(0,C.useContext)(N.Z);return(0,H.jsx)(p.Z,(0,M.Z)((0,M.Z)({valueEnum:(0,K.h)(L),request:R,params:u,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,M.Z)({getPopupContainer:ee.getPopupContainer},q),ref:g,proFieldProps:m},Y),{},{children:x}))}),A=C.forwardRef(z),O=b,c=A;c.SearchSelect=O,c.displayName="ProFormComponent",w.Z=c},24163:function(ne,w,e){var M=e(97857),E=e.n(M),K=e(25593),C=e(83062),N=e(62435),p=e(86074),H=K.Z.Paragraph;w.Z=function(d){var S=d.text,z=d.width,b=d.maxWidth,A=d.rows,O=A===void 0?2:A,c=d.placement,t=c===void 0?"top":c,g=d.color,W=g===void 0?"rgba(0, 0, 0, 0.88)":g,x=d.link,u=x===void 0?!1:x,m=d.onClickCallBackFunc,y=d.style,L=y===void 0?{}:y,R=d.copyable,T=R===void 0?!1:R;return(0,p.jsx)("div",{style:{maxWidth:b,width:z},children:(0,p.jsx)(C.Z,{title:(0,p.jsx)("div",{children:S}),placement:t,children:(0,p.jsx)(H,{ellipsis:{rows:O},style:E()({marginBottom:0,color:W,cursor:u?"pointer":""},L),onClick:m,copyable:T,children:S})})})}},77603:function(ne,w,e){e.d(w,{Z:function(){return ze}});var M=e(97857),E=e.n(M),K=e(15009),C=e.n(K),N=e(99289),p=e.n(N),H=e(5574),d=e.n(H),S=e(29297),z=e(55375),b=e(45830),A=e(85265),O=e(96486),c=e(62435),t=e(86074),g=function(D){var k=D.whiteListInstanceVisible,_=D.whiteListInstanceInfo,re=D.setWhiteListInstanceVisible,B=(0,c.useState)(""),J=d()(B,2),I=J[0],U=J[1],F=(0,b.useIntl)(),Q=function(){re(!1),U("")},le=function(){Q()};return(0,c.useEffect)(function(){if(k&&!(0,O.isEmpty)(_)){var X=JSON.stringify(_==null?void 0:_.outputEditor,null,4);(0,O.isEmpty)(X)||U(X)}},[k]),(0,t.jsx)(A.Z,{title:F.formatMessage({id:"common.message.text.execute.detail"}),width:"42%",destroyOnClose:!0,open:k,onClose:le,children:!(0,O.isEmpty)(I)&&(0,t.jsx)(S.q9,{editorKey:"assetInstance",value:I,readOnly:!0,editorStyle:{height:"100%"}})})},W=g,x=e(96655),u=e(29448),m=e(93410),y=e(50727),L=e(97462),R=e(5966),T=e(97269),Y=e(1413),q=e(91),ee=e(58055),ue=["fieldProps","request","params","proFieldProps"],we=function(D,k){var _=D.fieldProps,re=D.request,B=D.params,J=D.proFieldProps,I=(0,q.Z)(D,ue);return(0,t.jsx)(ee.Z,(0,Y.Z)({valueType:"segmented",fieldProps:_,ref:k,request:re,params:B,filedConfig:{customLightMode:!0},proFieldProps:J},I))},Ae=c.forwardRef(we),Be=Ae,Ue=e(90672),Ke=e(64317),Ne=e(25593),ke=e(68872),pe=e(71230),oe=e(15746),te=e(83622),he=e(86250),Ve=e(57381),$e=e(23323),j=e(68431),se={regoWrap:"regoWrap___iVxod",regoMain:"regoMain___eJpHo",customTitle:"customTitle___SrGFZ"},ge=Ne.Z.Title,xe="506px",Ge=600,He=function(D){var k=(0,b.useModel)("rule"),_=k.whiteListConfigList,re=k.allRuleList,B=D.editDrawerVisible,J=D.setEditDrawerVisible,I=D.whiteListDrawerInfo,U=D.tableActionRef,F=I.id,Q=I.riskId,le=I.isEditMode,X=le===void 0?!0:le,Je=(I==null?void 0:I.isLockHolder)||!1,P=!X,Qe=(0,c.useState)(!1),Ce=d()(Qe,2),Xe=Ce[0],ye=Ce[1],Ye=ke.ZP.useMessage(),Le=d()(Ye,2),ie=Le[0],qe=Le[1],l=(0,b.useIntl)(),V=(0,c.useRef)(),et=(0,c.useRef)(),tt=(0,c.useState)([]),Re=d()(tt,2),rt=Re[0],de=Re[1],ae=(0,c.useRef)(),it=(0,c.useState)(!1),_e=d()(it,2),nt=_e[0],Pe=_e[1],ot=(0,c.useState)(!1),De=d()(ot,2),st=De[0],Ie=De[1],lt=(0,c.useState)(j.wo),Me=d()(lt,2),ce=Me[0],Te=Me[1],at=(0,c.useState)(""),be=d()(at,2),je=be[0],me=be[1],Fe=(0,c.useRef)({outputEditor:""}),ut=function(r){Te(r)},dt=function(r){me(r)},ct=function(){var r;me(""),(r=V.current)===null||r===void 0||r.resetFields()},ve=function(){J(!1)},mt=function(){var s=p()(C()().mark(function r(){var i,n,o,a;return C()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return ye(!0),i={id:F},h.next=4,(0,x.queryWhiteRuleGrabLock)(i);case 4:n=h.sent,ye(!1),n.code===200&&(ie.success(l.formatMessage({id:"common.message.text.edit.success"})),I&&(I.isEditMode=!0,I.isLockHolder=!0),F&&Oe(F),U==null||(o=U.current)===null||o===void 0||(a=o.reloadAndRest)===null||a===void 0||a.call(o));case 7:case"end":return h.stop()}},r)}));return function(){return s.apply(this,arguments)}}(),vt=function(){var s=p()(C()().mark(function r(i){var n,o,a,v;return C()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return Pe(!0),n=E()(E()({},(0,j.Lg)(i)),{},{regoContent:ce}),F&&(n.id=F),Q&&(n.enable=1),f.next=6,(0,x.querySaveOrUpdateWhiteRule)(n);case 6:o=f.sent,Pe(!1),o.code===200&&o.msg==="success"&&(F?ie.success(l.formatMessage({id:"common.message.text.edit.success"})):ie.success(l.formatMessage({id:"common.message.text.add.success"})),J(!1),U==null||(a=U.current)===null||a===void 0||(v=a.reloadAndRest)===null||v===void 0||v.call(a));case 9:case"end":return f.stop()}},r)}));return function(i){return s.apply(this,arguments)}}(),ft=(0,b.useRequest)(function(s){return(0,x.queryWhiteListRuleExampleData)({riskRuleCode:s})},{manual:!0,formatResult:function(r){if(r.msg==="success"){var i=r.content;try{me(JSON.stringify(E()({},i),null,4)||"")}catch(n){console.info("Error",n)}}}}),fe=ft.run,Se=(0,b.useRequest)(function(s){return(0,x.queryWhiteListRuleById)({id:s})},{manual:!0,formatResult:function(r){var i=r.content;return(0,j.OV)(i)||{}},onSuccess:function(r){var i,n=r.condition,o=r.ruleType,a=r.ruleName,v=r.ruleDesc,h=r.ruleConfigList,f=r.editableKeyList,Z=r.riskRuleCode,$=r.regoContent;(i=V.current)===null||i===void 0||i.setFieldsValue({ruleType:o,ruleName:a,ruleDesc:v,ruleConfigList:h,condition:n,riskRuleCode:Z}),Te($),de(f),o===j.sN[1].value&&fe(Z)}}),Oe=Se.run,pt=Se.loading,We=(0,b.useRequest)(function(s){return(0,x.queryWhitedContentByRiskId)(s)},{manual:!0,formatResult:function(r){return(0,j.e$)(r==null?void 0:r.content)||{}},onSuccess:function(r){var i,n=r.condition,o=r.ruleType,a=r.ruleName,v=r.ruleDesc,h=r.ruleConfigList,f=r.editableKeyList,Z=r.riskRuleCode;(i=V.current)===null||i===void 0||i.setFieldsValue({ruleType:o,ruleName:a,ruleDesc:v,ruleConfigList:h,condition:n,riskRuleCode:Z}),de(f)}}),ht=We.run,gt=We.loading;(0,c.useEffect)(function(){B&&F?Oe(F):B&&Q?ht({riskId:Q}):B||ct()},[B]);var xt=function(r){if(r===j.sN[1].value){var i;fe((i=V.current)===null||i===void 0?void 0:i.getFieldValue("riskRuleCode"))}},Ze=function(){var s=p()(C()().mark(function r(){var i,n,o,a,v;return C()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=E()(E()({},(0,j.Lg)(((i=V.current)===null||i===void 0?void 0:i.getFieldsValue())||{})),{},{regoContent:ce}),((n=V.current)===null||n===void 0?void 0:n.getFieldValue("ruleType"))===j.sN[1].value&&(o.input=je),a=ie.loading(l.formatMessage({id:"common.message.text.execute.loading"})),f.next=5,(0,x.queryWhiteListTestRun)(o);case 5:v=f.sent,a(),v.code===200&&(Fe.current.outputEditor=v.content,Ie(!0),ie.success(l.formatMessage({id:"common.message.text.execute.success"})));case 8:case"end":return f.stop()}},r)}));return function(){return s.apply(this,arguments)}}(),Et=[{title:l.formatMessage({id:"involve.extend.title.serial.number"}),dataIndex:"id",editable:!1,width:100,align:"center",render:function(r,i,n){return n+1}},{title:l.formatMessage({id:"rule.module.text.variable.name"}),dataIndex:"key",formItemProps:{rules:[{required:!0}]},valueType:"select",fieldProps:function(r,i){var n=i.rowIndex,o=(_==null?void 0:_.map(function(a){return{label:a.keyName,value:a.key}}))||[];return{options:o,allowClear:!1,onSelect:function(){var v,h;(v=ae.current)===null||v===void 0||(h=v.setRowData)===null||h===void 0||h.call(v,n,{operator:void 0,value:void 0})}}}},{title:l.formatMessage({id:"involve.extend.title.condition"}),dataIndex:"operator",formItemProps:{rules:[{required:!0}]},valueType:"select",fieldProps:function(r,i){var n,o,a,v=i.rowIndex;if(P)return{options:[]};var h=(n=ae.current)===null||n===void 0||(o=n.getRowData)===null||o===void 0||(o=o.call(n,v))===null||o===void 0?void 0:o.key;if(!h)return[];var f=_==null?void 0:_.find(function($){return $.key===h}),Z=f==null||(a=f.operatorList)===null||a===void 0?void 0:a.map(function($){return{label:$,value:$}});return{options:Z||[]}}},{title:l.formatMessage({id:"rule.module.text.variable.value"}),dataIndex:"value",formItemProps:{rules:[{required:!0}]},valueType:function(r){var i;return(i=["resourceId","ip","resourceName"])!==null&&i!==void 0&&i.includes(r==null?void 0:r.key)?"text":"select"},fieldProps:function(r,i){var n,o,a,v,h=i.rowIndex;if(P)return{options:[]};var f=(n=ae.current)===null||n===void 0||(o=n.getRowData)===null||o===void 0||(o=o.call(n,h))===null||o===void 0?void 0:o.key;if((a=["resourceId","ip","resourceName"])!==null&&a!==void 0&&a.includes(f))return{};if(!f)return[];var Z=_==null?void 0:_.find(function(G){return G.key===f}),$=Z==null||(v=Z.value)===null||v===void 0?void 0:v.map(function(G){return{label:G==null?void 0:G.valueName,value:G==null?void 0:G.value}});return{showSearch:!0,options:$||[]}}},{title:l.formatMessage({id:"cloudAccount.extend.title.cloud.operate"}),valueType:"option",width:140,render:function(){return[]}}],Ct=function(){return(0,t.jsxs)(m.Z,{style:{marginBottom:20},bodyStyle:{backgroundColor:"rgb(245, 245, 245)",padding:"0 20px 16px 20px"},children:[(0,t.jsx)(y.Z,{rowKey:"idx",name:"ruleConfigList",actionRef:et,editableFormRef:ae,headerTitle:(0,t.jsx)("div",{style:{fontSize:14},children:l.formatMessage({id:"involve.extend.title.conditional.config"})}),recordCreatorProps:P?void 0:{creatorButtonText:l.formatMessage({id:"involve.extend.title.addRowConfig"}),record:function(){return{idx:(Math.random()*1e6).toFixed(0)}}},onChange:function(){var i;return(i=V.current)===null||i===void 0?void 0:i.setFieldValue("condition",void 0)},columns:Et,editable:P?void 0:{type:"multiple",editableKeys:rt,onChange:de,actionRender:function(i,n,o){return[o.delete]}}}),(0,t.jsx)(L.Z,{name:["ruleConfigList"],children:function(i){var n=i.ruleConfigList;return(0,t.jsxs)(pe.Z,{children:[(0,t.jsx)(oe.Z,{span:14,children:(0,t.jsx)(R.Z,{label:l.formatMessage({id:"involve.extend.title.logical"}),name:"condition",fieldProps:{placeholder:l.formatMessage({id:"involve.extend.title.logical.example"})},rules:[{required:(n==null?void 0:n.length)>1}],disabled:P})}),(0,t.jsx)(oe.Z,{children:(0,t.jsx)(te.ZP,{type:"link",style:{paddingRight:0,marginBottom:24},onClick:Ze,children:l.formatMessage({id:"common.button.text.test"})})})]})}})]})},yt=function(){return(0,t.jsx)("div",{className:se.regoWrap,children:(0,t.jsxs)(pe.Z,{className:se.regoMain,gutter:16,children:[(0,t.jsxs)(oe.Z,{md:14,span:24,children:[(0,t.jsx)(ge,{level:5,className:se.customTitle,style:{marginBottom:16},children:"The Rego PlayGround"}),(0,t.jsx)(S.mi,{editorKey:"WHITE_LIST_REGO_EDITOR",value:ce,onChange:ut,editorStyle:{height:xe},readOnly:P})]}),(0,t.jsxs)(oe.Z,{md:10,span:24,children:[(0,t.jsx)(ge,{level:5,className:se.customTitle,children:(0,t.jsxs)(he.Z,{justify:"space-between",align:"center",children:[(0,t.jsx)("span",{children:"INPUT"}),(0,t.jsx)(te.ZP,{type:"link",style:{paddingRight:0},onClick:Ze,disabled:P,children:l.formatMessage({id:"common.button.text.test"})})]})}),(0,t.jsx)(S.q9,{editorStyle:{height:xe},editorKey:"WHITE_LIST_INPUT_EDITOR",value:je,onChange:dt,readOnly:P})]})]})})};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(A.Z,{title:F?P?l.formatMessage({id:"common.button.text.view"})+l.formatMessage({id:"rule.extend.text.whiteList.title"}):l.formatMessage({id:"rule.extend.title.edit.whiteList"}):l.formatMessage({id:"rule.module.text.createWhiteList"}),width:"64%",destroyOnClose:!0,open:B,onClose:ve,styles:{body:{paddingBottom:52}},children:[qe,(0,t.jsxs)(Ve.Z,{spinning:pt||gt,children:[F&&!Je&&(0,t.jsxs)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#fff7e6",border:"1px solid #ffd591",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsx)("span",{style:{color:"#d46b08"},children:l.formatMessage({id:"rule.message.not.holding.lock"})}),(0,t.jsx)(te.ZP,{type:"primary",size:"small",loading:Xe,onClick:mt,children:l.formatMessage({id:"rule.table.columns.text.grab.lock"})})]}),(0,t.jsxs)(T.A,{onFinish:vt,formRef:V,layout:"horizontal",submitter:{submitButtonProps:{loading:nt,disabled:P},render:function(r,i){return(0,t.jsx)(he.Z,{justify:"end",gap:"small",children:P?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(te.ZP,{onClick:function(){return ve()},children:l.formatMessage({id:"common.button.text.close"})})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(te.ZP,{onClick:function(){return ve()},children:l.formatMessage({id:"common.button.text.cancel"})}),i]})})}},children:[(0,t.jsx)(Be,{name:"ruleType",label:l.formatMessage({id:"rule.extend.text.whiteList.type"}),initialValue:j.sN[0].value,valueEnum:(0,u.W_)(j.sN),formItemProps:{rules:[{required:!0,message:l.formatMessage({id:"rule.extend.text.select.whiteList.type"})}]},fieldProps:{onChange:xt},disabled:P}),(0,t.jsx)(R.Z,{label:l.formatMessage({id:"rule.extend.text.whiteList.title"}),name:"ruleName",formItemProps:{rules:[{required:!0}]},disabled:P}),(0,t.jsx)(Ue.Z,{label:l.formatMessage({id:"rule.extend.text.whiteList.describe"}),name:"ruleDesc",formItemProps:{rules:[{required:!1}]},disabled:P}),(0,t.jsx)(L.Z,{name:["ruleType"],children:function(r){var i=r.ruleType;return(0,t.jsx)(Ke.Z,{label:l.formatMessage({id:"rule.extend.text.risk.rule.code"}),disabled:!!Q||P,name:"riskRuleCode",formItemProps:{rules:[{required:!1}]},options:re||[],fieldProps:{showSearch:!0,filterOption:!0,onChange:(0,O.debounce)(function(n){i===j.sN[1].value&&fe(n)},Ge)}})}}),(0,t.jsx)(L.Z,{name:["ruleType"],children:function(r){var i=r.ruleType;return i===j.sN[1].value?yt():Ct()}}),Q&&(0,t.jsx)($e.Z.Item,{children:(0,t.jsx)("div",{style:{color:z.KC,fontSize:"13px"},children:"* \u767D\u540D\u5355\u63D0\u4EA4\u540E\u5C06\u6267\u884C\u98CE\u9669\u626B\u63CF\uFF08\u9884\u8BA130\u5206\u949F\u751F\u6548\uFF09\uFF0C\u8BF7\u52FF\u91CD\u590D\u63D0\u4EA4"})})]})]})]}),(0,t.jsx)(W,{whiteListInstanceVisible:st,setWhiteListInstanceVisible:Ie,whiteListInstanceInfo:Fe.current})]})},ze=He},68431:function(ne,w,e){e.d(w,{Lg:function(){return O},OV:function(){return c},e$:function(){return t},sN:function(){return A},wo:function(){return g}});var M=e(97857),E=e.n(M),K=e(13769),C=e.n(K),N=e(45830),p=e(96486),H=e.n(p),d=e(86074),S=["idx"],z=["id"],b=["id"],A=[{label:(0,d.jsx)(N.FormattedMessage,{id:"rule.module.text.rule.engine"}),value:"RULE_ENGINE"},{label:(0,d.jsx)(N.FormattedMessage,{id:"rule.module.text.rule.rego"}),value:"REGO"}],O=function(x){var u=(0,p.cloneDeep)(x),m=u.ruleConfigList;return Array.isArray(m)&&!(0,p.isEmpty)(m)&&(u.ruleConfigList=m.map(function(y,L){var R=y.idx,T=C()(y,S);return E()(E()({},T),{},{id:L+1})})||[]),u},c=function(x){var u=(0,p.cloneDeep)(x),m=JSON.parse((0,p.cloneDeep)(u==null?void 0:u.ruleConfig))||[],y=[];return Array.isArray(m)&&!(0,p.isEmpty)(m)&&(u.ruleConfigList=(m==null?void 0:m.map(function(L){var R=L.id,T=C()(L,z);return y.push(R),E()(E()({},T),{},{idx:R})}))||[]),u.editableKeyList=y,u},t=function(x){var u=(0,p.cloneDeep)(x),m=(0,p.cloneDeep)(u==null?void 0:u.ruleConfigList)||[],y=[];return Array.isArray(m)&&!(0,p.isEmpty)(m)&&(u.ruleConfigList=(m==null?void 0:m.map(function(L){var R=L.id,T=C()(L,b);return y.push(R),E()(E()({},T),{},{idx:R})}))||[]),u.editableKeyList=y,u},g=`package cloudrec_white_list

import rego.v1
  
default whited = false
  
whited if {
   input.method == "GET"
   input.path == "/public/resource"
}
`},53846:function(ne,w){w.Z={customTitle:"customTitle___nzcxh",riskHigh:"riskHigh___GstO6",riskMedium:"riskMedium___F4JTb",riskLow:"riskLow___HJopw",imgProcess:"imgProcess___NGndv",imgResult:"imgResult___wKhiG",validTag:"validTag___TRSau",invalidTag:"invalidTag___opVlG",waitingTag:"waitingTag___JZpZT"}}}]);
